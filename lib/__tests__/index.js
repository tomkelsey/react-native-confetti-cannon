var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var React=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _reactTestRenderer=_interopRequireDefault(require("react-test-renderer"));var _=_interopRequireWildcard(require(".."));var _jsxFileName="/Users/tomkelsey/Code/react-native-confetti-cannon/src/__tests__/index.js";function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}describe('index',function(){beforeEach(function(){jest.useFakeTimers();_reactNative.Platform.OS='ios';});it('should trigger animations callbacks',function(){var handleAnimationStart=jest.fn();var handleAnimationResume=jest.fn();var handleAnimationStop=jest.fn();var handleAnimationEnd=jest.fn();_reactTestRenderer.default.create(React.createElement(_.default,{count:10,origin:{x:-10,y:0},onAnimationStart:handleAnimationStart,onAnimationResume:handleAnimationResume,onAnimationStop:handleAnimationStop,onAnimationEnd:handleAnimationEnd,__source:{fileName:_jsxFileName,lineNumber:22,columnNumber:7}}));jest.runOnlyPendingTimers();expect(handleAnimationStart).toHaveBeenCalledTimes(1);expect(handleAnimationEnd).toHaveBeenCalledTimes(0);jest.advanceTimersByTime(_.DEFAULT_EXPLOSION_SPEED+_.DEFAULT_FALL_SPEED);expect(handleAnimationEnd).toHaveBeenCalledTimes(1);expect(handleAnimationResume).toHaveBeenCalledTimes(0);expect(handleAnimationStop).toHaveBeenCalledTimes(0);});it('should be able to customize speeds',function(){var handleAnimationStart=jest.fn();var handleAnimationEnd=jest.fn();var explosionSpeed=35;var fallSpeed=300;_reactTestRenderer.default.create(React.createElement(_.default,{count:10,origin:{x:-10,y:0},explosionSpeed:explosionSpeed,fallSpeed:fallSpeed,fadeOut:true,onAnimationStart:handleAnimationStart,onAnimationEnd:handleAnimationEnd,__source:{fileName:_jsxFileName,lineNumber:51,columnNumber:7}}));expect(handleAnimationEnd).toHaveBeenCalledTimes(0);jest.advanceTimersByTime(explosionSpeed+fallSpeed);expect(handleAnimationEnd).toHaveBeenCalledTimes(1);});it('should not start if autoStart is disabled',function(){var handleAnimationStart=jest.fn();_reactTestRenderer.default.create(React.createElement(_.default,{count:10,origin:{x:-10,y:0},autoStart:false,onAnimationStart:handleAnimationStart,__source:{fileName:_jsxFileName,lineNumber:73,columnNumber:7}}));jest.advanceTimersByTime(_.DEFAULT_EXPLOSION_SPEED+_.DEFAULT_FALL_SPEED);expect(handleAnimationStart).toHaveBeenCalledTimes(0);});it('should start after delay',function(){var autoStartDelay=100;var handleAnimationStart=jest.fn();_reactTestRenderer.default.create(React.createElement(_.default,{count:10,origin:{x:-10,y:0},autoStartDelay:autoStartDelay,onAnimationStart:handleAnimationStart,__source:{fileName:_jsxFileName,lineNumber:91,columnNumber:7}}));jest.advanceTimersByTime(autoStartDelay-1);expect(handleAnimationStart).toHaveBeenCalledTimes(0);jest.advanceTimersByTime(1);expect(handleAnimationStart).toHaveBeenCalledTimes(1);});it('should be able to start animation programmatically',function(){var handleAnimationStart=jest.fn();var handleAnimationResume=jest.fn();var handleAnimationStop=jest.fn();var handleAnimationEnd=jest.fn();var ref=jest.fn();_reactTestRenderer.default.create(React.createElement(_.default,{count:10,origin:{x:-10,y:0},autoStart:false,onAnimationStart:handleAnimationStart,onAnimationResume:handleAnimationResume,onAnimationStop:handleAnimationStop,onAnimationEnd:handleAnimationEnd,ref:ref,__source:{fileName:_jsxFileName,lineNumber:116,columnNumber:7}}));var _ref$mock$calls$=(0,_slicedToArray2.default)(ref.mock.calls[0],1),confettiCannon=_ref$mock$calls$[0];confettiCannon&&confettiCannon.start();expect(handleAnimationStart).toHaveBeenCalledTimes(1);expect(handleAnimationResume).toHaveBeenCalledTimes(0);expect(handleAnimationStop).toHaveBeenCalledTimes(0);expect(handleAnimationEnd).toHaveBeenCalledTimes(0);confettiCannon&&confettiCannon.stop();expect(handleAnimationStart).toHaveBeenCalledTimes(1);expect(handleAnimationResume).toHaveBeenCalledTimes(0);expect(handleAnimationStop).toHaveBeenCalledTimes(1);expect(handleAnimationEnd).toHaveBeenCalledTimes(0);confettiCannon&&confettiCannon.resume();expect(handleAnimationStart).toHaveBeenCalledTimes(1);expect(handleAnimationResume).toHaveBeenCalledTimes(1);expect(handleAnimationStop).toHaveBeenCalledTimes(1);expect(handleAnimationEnd).toHaveBeenCalledTimes(0);jest.advanceTimersByTime(_.DEFAULT_EXPLOSION_SPEED+_.DEFAULT_FALL_SPEED);expect(handleAnimationStart).toHaveBeenCalledTimes(1);expect(handleAnimationResume).toHaveBeenCalledTimes(1);expect(handleAnimationStop).toHaveBeenCalledTimes(1);expect(handleAnimationEnd).toHaveBeenCalledTimes(1);});it('should re-render items without changing colors already set',function(){var origin={x:-10,y:0};var count1=10;var count2=20;var count3=5;var component=_reactTestRenderer.default.create(React.createElement(_.default,{count:count1,origin:origin,__source:{fileName:_jsxFileName,lineNumber:166,columnNumber:7}}));var confettis1=component.root.findAll(function(el){return el.props.testID&&el.props.testID.match(/confetti/g);});var colors1=confettis1.map(function(confetti){return confetti.props.color;});expect(confettis1.length).toEqual(count1);component.update(React.createElement(_.default,{count:count2,origin:origin,__source:{fileName:_jsxFileName,lineNumber:175,columnNumber:7}}));var confettis2=component.root.findAll(function(el){return el.props.testID&&el.props.testID.match(/confetti/g);});var colors2=confettis2.map(function(confetti){return confetti.props.color;});expect(confettis2.length).toEqual(count2);expect(colors1).toEqual(colors2.slice(0,count1));component.update(React.createElement(_.default,{count:count3,origin:origin,__source:{fileName:_jsxFileName,lineNumber:185,columnNumber:7}}));var confettis3=component.root.findAll(function(el){return el.props.testID&&el.props.testID.match(/confetti/g);});var colors3=confettis3.map(function(confetti){return confetti.props.color;});expect(confettis3.length).toEqual(count3);expect(colors1.slice(0,count3)).toEqual(colors3.slice(0,count3));});it('should re-render items colors if colors prop changes',function(){var origin={x:-10,y:0};var count=1;var color1='#000';var color2='#fff';var component=_reactTestRenderer.default.create(React.createElement(_.default,{count:count,origin:origin,colors:[color1],__source:{fileName:_jsxFileName,lineNumber:202,columnNumber:7}}));var confetti=component.root.find(function(el){return el.props.testID==='confetti-1';});expect(confetti.props.color).toEqual(color1);component.update(React.createElement(_.default,{count:count,origin:origin,colors:[color2],__source:{fileName:_jsxFileName,lineNumber:210,columnNumber:7}}));expect(confetti.props.color).toEqual(color2);});it('should not change items if colors or count dont change',function(){var origin={x:-10,y:0};var count=1000;var component=_reactTestRenderer.default.create(React.createElement(_.default,{count:count,origin:origin,__source:{fileName:_jsxFileName,lineNumber:221,columnNumber:7}}));var confettis1=component.root.findAll(function(el){return el.props.testID&&el.props.testID.match(/confetti/g);});component.update(React.createElement(_.default,{count:count,origin:origin,fadeOut:true,__source:{fileName:_jsxFileName,lineNumber:227,columnNumber:7}}));var confettis2=component.root.findAll(function(el){return el.props.testID&&el.props.testID.match(/confetti/g);});expect(confettis1).toEqual(confettis2);});it('should include the perspective transform on the Android platform',function(){_reactNative.Platform.OS='android';var origin={x:-10,y:0};var count=1000;var component=_reactTestRenderer.default.create(React.createElement(_.default,{count:count,origin:origin,__source:{fileName:_jsxFileName,lineNumber:242,columnNumber:7}}));var confetti=component.root.find(function(el){return el.props.testID==='confetti-1';});expect(confetti.props.transform).toEqual(expect.arrayContaining([{perspective:100}]));});it('should set "renderToHardwareTextureAndroid" prop to true for confetti animated view',function(){var origin={x:-10,y:0};var count=1000;var component=_reactTestRenderer.default.create(React.createElement(_.default,{count:count,origin:origin,__source:{fileName:_jsxFileName,lineNumber:254,columnNumber:7}}));var confettiAnimatedView=component.root.find(function(el){return el.props.testID==='confetti-1';}).findByType(_reactNative.Animated.View);expect(confettiAnimatedView.props.renderToHardwareTextureAndroid).toEqual(true);});it('should not render children if autoStart is disabled',function(){var origin={x:-10,y:0};var count=10;var component=_reactTestRenderer.default.create(React.createElement(_.default,{count:count,origin:origin,autoStart:false,__source:{fileName:_jsxFileName,lineNumber:269,columnNumber:7}}));expect(component.toJSON()).toBeNull();});it('should render children when started programatically and unmount after animation',function(){var ref=jest.fn();var count=10;var component=_reactTestRenderer.default.create(React.createElement(_.default,{count:count,origin:{x:-10,y:0},autoStart:false,ref:ref,__source:{fileName:_jsxFileName,lineNumber:278,columnNumber:7}}));var _ref$mock$calls$2=(0,_slicedToArray2.default)(ref.mock.calls[0],1),confettiCannon=_ref$mock$calls$2[0];confettiCannon&&confettiCannon.start();var items=component.root.findAll(function(el){return el.props.testID&&el.props.testID.match(/confetti/g);});expect(items.length).toEqual(count);confettiCannon&&confettiCannon.stop();var itemsAfterStrop=component.root.findAll(function(el){return el.props.testID&&el.props.testID.match(/confetti/g);});expect(itemsAfterStrop.length).toEqual(count);confettiCannon&&confettiCannon.resume();jest.advanceTimersByTime(_.DEFAULT_EXPLOSION_SPEED+_.DEFAULT_FALL_SPEED);expect(component.toJSON()).toBeNull();});});
//# sourceMappingURL=index.js.map