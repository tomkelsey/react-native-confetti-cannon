{"version":3,"sources":["../src/index.js"],"names":["TOP_MIN","DEFAULT_COLORS","DEFAULT_EXPLOSION_SPEED","DEFAULT_FALL_SPEED","Explosion","props","state","items","showItems","animation","Animated","Value","componentDidMount","autoStart","autoStartDelay","setTimeout","start","componentDidUpdate","prevCount","count","colors","prevColors","setState","getItems","difference","length","newItems","Array","fill","map","leftDelta","topDelta","swingDelta","speedDelta","rotateX","rotateY","rotateZ","color","slice","concat","item","resume","explosionSpeed","fallSpeed","onAnimationStart","onAnimationResume","onAnimationEnd","sequence","timing","toValue","duration","useNativeDriver","easing","Easing","out","quad","finished","stop","onAnimationStop","bind","origin","fadeOut","Dimensions","get","height","width","index","left","interpolate","inputRange","outputRange","x","top","y","translateX","opacity","containerTransform","translateY","transform","rotate","Platform","OS","push","perspective","React","PureComponent"],"mappings":"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","sourcesContent":["// @flow\n\nimport * as React from 'react';\nimport { Animated, Dimensions, Easing, Platform } from 'react-native';\nimport type { CompositeAnimation } from 'react-native/Libraries/Animated/src/AnimatedImplementation';\nimport type { EndResult } from 'react-native/Libraries/Animated/src/animations/Animation';\n\nimport Confetti from './components/confetti';\nimport { randomValue, randomColor } from './utils';\n\ntype Props = {|\n  count: number,\n  origin: {\n    x: number,\n    y: number\n  },\n  explosionSpeed?: number,\n  fallSpeed?: number,\n  colors?: Array<string>,\n  fadeOut?: boolean,\n  autoStart?: boolean,\n  autoStartDelay?: number,\n  onAnimationStart?: () => void,\n  onAnimationResume?: () => void,\n  onAnimationStop?: () => void,\n  onAnimationEnd?: () => void,\n  testID?: string\n|};\n\ntype Item = {|\n  leftDelta: number,\n  topDelta: number,\n  swingDelta: number,\n  speedDelta: {\n    rotateX: number,\n    rotateY: number,\n    rotateZ: number\n  },\n  color: string\n|};\n\ntype State = {|\n  items: Array<Item>,\n  showItems : boolean\n|};\n\nexport const TOP_MIN = 0.7;\nexport const DEFAULT_COLORS: Array<string> =[\n  '#e67e22',\n  '#2ecc71',\n  '#3498db',\n  '#84AAC2',\n  '#E6D68D',\n  '#F67933',\n  '#42A858',\n  '#4F50A2',\n  '#A86BB7',\n  '#e74c3c',\n  '#1abc9c'\n];\nexport const DEFAULT_EXPLOSION_SPEED = 350;\nexport const DEFAULT_FALL_SPEED = 3000;\n\nclass Explosion extends React.PureComponent<Props, State> {\n  props: Props;\n  state: State = {\n    items: [],\n    showItems : false\n  };\n  start: () => void;\n  resume: () => void;\n  stop: () => void;\n  sequence: CompositeAnimation | null;\n  items: Array<Item> = [];\n  animation: Animated.Value = new Animated.Value(0);\n\n  constructor(props: Props) {\n    super(props);\n\n    const { colors = DEFAULT_COLORS } = props;\n\n    this.start = this.start.bind(this);\n    this.resume = this.resume.bind(this);\n    this.stop = this.stop.bind(this);\n\n    this.state.items = this.getItems(colors);\n  }\n\n  componentDidMount = () => {\n    const { autoStart = true, autoStartDelay = 0 } = this.props;\n\n    if (autoStart) {\n      // Set Timeout with zero delay is not instantenous. Waits for a cycle\n      if(autoStartDelay){\n        setTimeout(this.start, autoStartDelay);\n      }\n      else{\n        this.start();\n      }\n    }\n  };\n\n  componentDidUpdate = ({ count: prevCount, colors: prevColors = DEFAULT_COLORS }: Props) => {\n    const { count, colors = DEFAULT_COLORS } = this.props;\n\n    if (count !== prevCount || colors !== prevColors) {\n      this.setState({\n        items: this.getItems(prevColors)\n      });\n    }\n  };\n\n  getItems = (prevColors: Array<string>): Array<Item> => {\n    const { count, colors = DEFAULT_COLORS } = this.props;\n    const { items } = this.state;\n\n    const difference = items.length < count ? count - items.length : 0;\n\n    const newItems = Array(difference).fill().map((): Item => ({\n      leftDelta: randomValue(0, 1),\n      topDelta: randomValue(TOP_MIN, 1),\n      swingDelta: randomValue(0.2, 1),\n      speedDelta: {\n        rotateX: randomValue(0.3, 1),\n        rotateY: randomValue(0.3, 1),\n        rotateZ: randomValue(0.3, 1)\n      },\n      color: randomColor(colors)\n    }));\n\n    return items\n      .slice(0, count)\n      .concat(newItems)\n      .map(item => ({\n        ...item,\n        color: prevColors !== colors ? randomColor(colors) : item.color\n      }));\n  };\n\n  start = (resume?: boolean = false) => {\n    this.setState({\n      showItems:true,\n    }, ()=>{\n      const {\n        explosionSpeed = DEFAULT_EXPLOSION_SPEED,\n        fallSpeed = DEFAULT_FALL_SPEED,\n      onAnimationStart,\n      onAnimationResume,\n      onAnimationEnd\n    } = this.props;\n    \n    if (resume) {\n      onAnimationResume && onAnimationResume();\n    } else {\n      this.sequence = Animated.sequence([\n        Animated.timing(this.animation, {toValue: 0, duration: 0, useNativeDriver: true}),\n        Animated.timing(this.animation, {\n          toValue: 1,\n          duration: explosionSpeed,\n          easing: Easing.out(Easing.quad),\n          useNativeDriver: true\n        }),\n        Animated.timing(this.animation, {\n          toValue: 2,\n          duration: fallSpeed,\n          easing: Easing.quad,\n          useNativeDriver: true\n        }),\n      ]);  \n      onAnimationStart && onAnimationStart();\n    } \n    \n    this.sequence && this.sequence.start(({finished}: EndResult) => {\n      if (finished) {\n        onAnimationEnd && onAnimationEnd();\n        this.setState({\n          showItems:false\n        })\n      }\n    });\n  })\n  };\n\n  resume = () => this.start(true);\n\n  stop = () => {\n    const { onAnimationStop } = this.props;\n\n    onAnimationStop && onAnimationStop();\n\n    this.sequence && this.sequence.stop();\n  };\n\n  render() {\n    const { origin, fadeOut } = this.props;\n    const { items } = this.state;\n    const { height, width } = Dimensions.get('window');\n    if(!this.state.showItems){\n      return null;\n    }\n    return (\n      <React.Fragment>\n        {items.map((item: Item, index: number) => {\n          const left = this.animation.interpolate({\n            inputRange: [0, 1, 2],\n            outputRange: [origin.x, item.leftDelta * width, item.leftDelta * width]\n          });\n          const top = this.animation.interpolate({\n            inputRange: [0, 1, 1 + item.topDelta, 2],\n            outputRange: [-origin.y, -item.topDelta * height, 0, 0]\n          });\n          const rotateX = this.animation.interpolate({\n            inputRange: [0, 2],\n            outputRange: ['0deg', `${item.speedDelta.rotateX * 360 * 10}deg`]\n          });\n          const rotateY = this.animation.interpolate({\n            inputRange: [0, 2],\n            outputRange: ['0deg', `${item.speedDelta.rotateY * 360 * 5}deg`]\n          });\n          const rotateZ = this.animation.interpolate({\n            inputRange: [0, 2],\n            outputRange: ['0deg', `${item.speedDelta.rotateZ * 360 * 2}deg`]\n          });\n          const translateX = this.animation.interpolate({\n            inputRange: [0, 0.4, 1.2, 2],\n            outputRange: [0, -(item.swingDelta * 30), (item.swingDelta * 30), 0]\n          });\n          const opacity = this.animation.interpolate({\n            inputRange: [0, 1, 1.8, 2],\n            outputRange: [1, 1, 1, fadeOut ? 0 : 1]\n          });\n          const containerTransform = [{translateX: left}, {translateY: top}];\n          const transform = [{rotateX}, {rotateY}, {rotate: rotateZ}, {translateX}];\n\n          if (Platform.OS === 'android') {\n            transform.push({ perspective: 100 });\n          }\n\n          return (\n            <Confetti\n              color={item.color}\n              containerTransform={containerTransform}\n              transform={transform}\n              opacity={opacity}\n              key={index}\n              testID={`confetti-${index + 1}`}\n            />\n          );\n        })}\n      </React.Fragment>\n    );\n  }\n}\n\nexport default Explosion;\n"],"file":"index.js"}